import{u as I,j as e,e as j,f,g as b,h as v,m as N,n as F,o as L,ar as k,p as E,$ as m,I as u,B as w,L as T}from"./ui-TF4rhkS0.js";import{r as c}from"./vendor-CYNtys_G.js";import{c as U,u as V}from"./index-lQGp847G.js";import{c as R,a as q}from"./client-DO6i2ohs.js";const B=o=>{const s=o.replace(/\D/g,"");return s.length<=3?s:s.length<=6?`${s.slice(0,3)}.${s.slice(3)}`:s.length<=9?`${s.slice(0,3)}.${s.slice(3,6)}.${s.slice(6)}`:`${s.slice(0,3)}.${s.slice(3,6)}.${s.slice(6,9)}-${s.slice(9,11)}`},G=o=>{const s=o.replace(/\D/g,"");return s.length<=2?s:s.length<=7?`(${s.slice(0,2)}) ${s.slice(2)}`:`(${s.slice(0,2)}) ${s.slice(2,7)}-${s.slice(7,11)}`},z=()=>{const{availablePlans:o}=U(),{user:s}=V(),{toast:p}=I(),[C,A]=c.useState("basic"),[X,$]=c.useState(!1),[h,t]=c.useState(null),[g,y]=c.useState(null),[P,S]=c.useState(null),[l,x]=c.useState({name:"",email:(s==null?void 0:s.email)||"",cpf:"",phone:""}),d=a=>{h&&t(null);const{name:i,value:n}=a.target;x(i==="cpf"?r=>({...r,[i]:B(n)}):i==="phone"?r=>({...r,[i]:G(n)}):r=>({...r,[i]:n}))},D=async a=>{if(a.preventDefault(),t(null),y(null),S(null),!s){t("Você precisa estar logado para assinar um plano."),p({title:"Login necessário",description:"Você precisa estar logado para assinar um plano.",variant:"destructive"});return}if(!l.name||!l.email||!l.cpf){t("Por favor, preencha todos os campos obrigatórios.");return}const i=l.cpf.replace(/\D/g,"");if(i.length!==11){t("Por favor, insira um CPF válido com 11 dígitos.");return}$(!0);try{console.log("Iniciando criação de cliente no Asaas...");const n=await R({name:l.name,email:l.email,cpfCnpj:i,mobilePhone:l.phone.replace(/\D/g,"")});console.log("Cliente criado/recuperado com ID:",n),console.log("Criando assinatura para o cliente...");const r=await q(C,s.id,n);S(r.subscriptionId),y(r.redirectUrl),console.log("Assinatura criada, redirecionando para:",r.redirectUrl),p({title:"Assinatura criada com sucesso!",description:"Veja o link de pagamento abaixo."})}catch(n){console.error("Erro no processo de assinatura:",n);let r="Ocorreu um erro ao processar sua assinatura.";n instanceof Error?t(`${r} ${n.message}`):t(r),p({title:"Erro na assinatura",description:r,variant:"destructive"})}finally{$(!1)}};return e.jsxs("div",{className:"container mx-auto py-10 px-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8 text-center",children:"Teste de Integração Asaas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(b,{children:"Escolha um plano"}),e.jsx(v,{children:"Selecione um plano para testar a assinatura"})]}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:o.filter(a=>a.interval==="monthly").map(a=>e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer ${C===a.id?"border-vegas-gold bg-vegas-gold/10":"border-gray-700 hover:border-gray-500"}`,onClick:()=>A(a.id),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold",children:a.name}),e.jsx("span",{className:"font-bold",children:a.price===0?"Grátis":`R$ ${a.price.toFixed(2)}`})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:a.description})]},a.id))})})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(b,{children:"Dados para teste"}),e.jsx(v,{children:"Preencha os dados para criar uma assinatura"})]}),e.jsxs(N,{children:[h&&e.jsxs(F,{variant:"destructive",className:"mb-4",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(k,{children:"Erro"}),e.jsx(E,{children:h})]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"name",children:"Nome completo *"}),e.jsx(u,{id:"name",name:"name",value:l.name,onChange:d,placeholder:"Seu nome completo",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:"E-mail *"}),e.jsx(u,{id:"email",name:"email",type:"email",value:l.email,onChange:d,placeholder:"seu@email.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"cpf",children:"CPF *"}),e.jsx(u,{id:"cpf",name:"cpf",value:l.cpf,onChange:d,placeholder:"XXX.XXX.XXX-XX",maxLength:14,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone",children:"Telefone"}),e.jsx(u,{id:"phone",name:"phone",value:l.phone,onChange:d,placeholder:"(XX) XXXXX-XXXX",maxLength:15})]}),e.jsx(w,{type:"submit",className:"w-full bg-vegas-gold hover:bg-vegas-gold/80 text-black",disabled:X,children:X?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):"Criar Assinatura de Teste"})]})]})]})]}),g&&e.jsxs(j,{className:"mt-8",children:[e.jsxs(f,{children:[e.jsx(b,{children:"Assinatura criada com sucesso!"}),e.jsxs(v,{children:["SubscriptionId: ",P]})]}),e.jsxs(N,{children:[e.jsxs("div",{className:"p-4 bg-vegas-gold/10 rounded-lg",children:[e.jsx("p",{className:"mb-4",children:"Link de pagamento gerado:"}),e.jsx("a",{href:g,target:"_blank",rel:"noopener noreferrer",className:"block w-full p-3 bg-vegas-gold text-black text-center rounded-lg hover:bg-vegas-gold/80 transition-colors",children:"Acessar página de pagamento"})]}),e.jsxs("div",{className:"mt-4 p-4 border border-gray-700 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"URL Completa:"}),e.jsx("p",{className:"text-xs break-all bg-black p-2 rounded-lg",children:g})]})]})]})]})};export{z as default};
